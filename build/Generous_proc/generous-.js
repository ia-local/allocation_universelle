require('dotenv').config();
const express = require('express');
const { GoogleGenerativeAI } = require('@google/generative-ai');
const fs = require('fs');
const path = require('path');
const Groq = require('groq-sdk');
const groq = new Groq({ apiKey: process.env.GROQ_API_KEY });
const sharp = require('sharp'); // Importez le module sharp ici
const app = express();
const port = 5007;
const generositeProgrammeePiliers = require('./public/generositeProgrammee');

const Generous = {
    "conceptTitle": "G√©n√©rosit√© Programm√©e",
    "tagline": "Quand la Technologie Sert la Solidarit√©",
    "introduction": "Imaginez un futur o√π la solidarit√© n'est pas seulement un √©lan du c≈ìur, mais une opportunit√© int√©gr√©e, fluide et transparente dans notre quotidien. Un futur o√π les surplus budg√©taires individuels peuvent se transformer en un soutien concret pour ceux qui en ont le plus besoin, en quelques clics et avec une visibilit√© totale. Ce futur, c'est la promesse de la G√©n√©rosit√© Programm√©e.",
    "context": {
      "problemStatement": "Les m√©canismes de redistribution existants peuvent parfois sembler complexes, distants ou manquer de clart√© quant √† leur impact direct. Parall√®lement, des surplus budg√©taires individuels repr√©sentent un potentiel consid√©rable pour amplifier la solidarit√©.",
      "opportunity": "Connecter les surplus budg√©taires individuels aux besoins sociaux urgents de mani√®re innovante et efficace."
    },
    "coreIdea": {
      "title": "L'√âtat comme Facilitateur de la Solidarit√©",
      "description": "L'√âtat joue un r√¥le proactif en cr√©ant un canal direct et transparent entre les citoyens et les causes sociales v√©rifi√©es, en s'appuyant sur les outils num√©riques et les donn√©es fiscales existantes."
    },
    "operation": {
      "title": "Fonctionnement en Quatre √âtapes Cl√©s",
      "steps": [
        {
          "stepNumber": 1,
          "title": "Notification Personnalis√©e",
          "description": "Un citoyen re√ßoit une notification claire et s√©curis√©e l'informant d'un surplus budg√©taire potentiel, pr√©sent√©e comme une opportunit√© d'agir.",
          "example": "Claire re√ßoit un message concernant un trop-per√ßu fiscal."
        },
        {
          "stepNumber": 2,
          "title": "Choix √âclair√© via une Interface Intuitive (G√âN√âROS)",
          "description": "Le syst√®me intelligent G√âN√âROS propose des options de redistribution claires et contextualis√©es, avec des informations sur les causes, leur urgence et l'impact potentiel d'un don.",
          "systemName": "G√âN√âROS"
        },
        {
          "stepNumber": 3,
          "title": "Action Simple et Ma√Ætris√©e",
          "description": "Le citoyen choisit le montant √† redistribuer et la cause √† soutenir, conservant un contr√¥le total sur sa d√©cision. L'interface est simple et inspire confiance.",
          "userControl": true
        },
        {
          "stepNumber": 4,
          "title": "Feedback Transparent et Valorisation",
          "description": "Le citoyen re√ßoit un retour d'information pr√©cis sur l'impact concret de son don, potentiellement avec des t√©moignages et des donn√©es quantifiables. Une reconnaissance fiscale peut valoriser cet acte de solidarit√©.",
          "feedbackMechanism": true,
          "potentialBenefit": "Reconnaissance fiscale"
        }
      ]
    },
    "technologyIntegration": {
      "title": "L'Apport Potentiel de la Technologie Blockchain (Smart Contracts)",
      "description": "L'utilisation de la blockchain et des Smart Contracts (comme `cvnu.sol` adapt√©) pourrait automatiser et enregistrer de mani√®re immuable chaque √©tape du processus, offrant une tra√ßabilit√© totale et une v√©rification par tous.",
      "technologies": ["Blockchain", "Smart Contracts"],
      "exampleContract": "cvnu.sol (adapt√©)",
      "benefits": ["Transparence Totale", "Tra√ßabilit√© Compl√®te", "V√©rification par Tous"]
    },
    "keyBenefits": [
      "Efficacit√© Accrue : Canalisation rapide des fonds vers les besoins urgents.",
      "Transparence Totale : Information claire sur les causes, l'impact et potentiellement la tra√ßabilit√© via la blockchain.",
      "Responsabilisation Citoyenne : Offre une mani√®re simple et directe de contribuer au bien commun.",
      "Sans Surco√ªt pour l'√âtat (potentiel) : Utilisation de fonds d√©j√† disponibles (surplus budg√©taires).",
      "Valorisation de la Solidarit√© : Reconnaissance de l'engagement citoyen."
    ],
    "ethicalAndDiscussionPoints": {
      "title": "Les Questions √âthiques et les Points de Discussion",
      "points": [
        "Volontariat vs. Incitation Morale : Le syst√®me doit-il rester purement volontaire ou peut-on envisager des m√©canismes d'incitation plus forts ?",
        "Utilisation des Donn√©es Fiscales : Quelles sont les limites √©thiques de l'utilisation de ces donn√©es √† des fins de redistribution ?",
        "Neutralit√© et Fiabilit√© de l'IA (G√âN√âROS) : Comment garantir l'objectivit√© de l'IA dans l'identification des besoins et la s√©lection des causes ?",
        "R√¥le de l'√âtat : Ce syst√®me doit-il √™tre un compl√©ment ou une alternative aux dispositifs sociaux existants ?",
        "Confiance et Adh√©sion : Comment assurer l'adh√©sion des citoyens et r√©pondre √† leurs √©ventuelles craintes ?"
      ]
    },
    "conclusion": "La G√©n√©rosit√© Programm√©e repr√©sente une vision audacieuse et innovante de la solidarit√© au 21√®me si√®cle. En exploitant la puissance de la technologie, elle offre un potentiel unique pour rendre l'acte de donner plus simple, plus transparent et plus impactant. En ouvrant la discussion sur ses implications √©thiques et pratiques, nous pouvons collectivement fa√ßonner un avenir o√π la technologie sert v√©ritablement l'humain et renforce les liens de notre soci√©t√©."
  };

app.use(express.static('public/'));

app.get('/', (req, res) => {
    res.sendFile(path.join(__dirname, 'public', 'index.html'));
});
app.get('/piliers', (req, res) => {
  res.json(generositeProgrammeePiliers); // Envoie les informations des piliers au format JSON
});
// Nouvelle route pour r√©cup√©rer l'objet Generous
app.get('/generous-data', (req, res) => {
    res.json(Generous); // Envoie l'objet Generous au format JSON
});

async function generateImageDescription(topic) {
    try {
        const chatCompletion = await groq.chat.completions.create({
            messages: [
                { role: 'assistant', content: `** **<br/> | in box |.`, },
                {
                    role: 'user',
                    content: `** D√©cris une image qui illustre le th√®me suivant : ${topic}. La description doit √™tre suffisamment d√©taill√©e pour g√©n√©rer une image pertinente.`,
                },
            ],
            model: 'gemma2-9b-it',
        });

        return chatCompletion.choices[0].message.content;
    } catch (error) {
        console.error('Erreur lors de la g√©n√©ration de la description de l\'image :', error);
        return 'Image abstraite li√©e √† l\'intelligence artificielle.'; // Description par d√©faut en cas d'erreur
    }
}
app.get('/image', async (req, res) => {
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);
    const topic = req.query.topic; // R√©cup√®re la th√©matique √† partir des param√®tres de la requ√™te

    try {
        // G√©n√©ration de la description de l'image en fonction de la th√©matique
        const imageDescription = await generateImageDescription(topic);

        const model = genAI.getGenerativeModel({
            model: 'gemini-2.0-flash-exp',
            generationConfig: {
                responseModalities: ['Text', 'Image'],
            },
        });

        const response = await model.generateContent(imageDescription);
        for (const part of response.response.candidates[0].content.parts) {
            if (part.inlineData) {
                const imageData = part.inlineData.data;
                res.json({ image: imageData });
                return;
            }
        }
        res.status(500).send('Image non trouv√©e');
    } catch (error) {
        console.error('Erreur :', error);
        res.status(500).send('Erreur lors de la g√©n√©ration de l\'image');
    }
});

app.get('/conversation_agi', async (req, res) => {
  try {
    const chatCompletion = await groq.chat.completions.create({
        messages: [
          {
            role: 'system',
            content: 'Vous √™tes un assistant IA sp√©cialis√© dans la G√©n√©rosit√© Programm√©e et ses aspects techniques. Expliquez les concepts en tenant compte des trois piliers : Transparence et Confiance, Impact et Mesurabilit√©, et Int√©gration et Accessibilit√©.',
        },
        {
            role: 'user',
            content: 'Expliquez bri√®vement le r√¥le des Smart Contracts dans la G√©n√©rosit√© Programm√©e.',
        },
        {
            role: 'assistant',
            content: 'Les Smart Contracts üìú automatisent et s√©curisent les transactions de dons, assurant la **transparence** et la **confiance** en enregistrant chaque √©tape de mani√®re immuable sur la blockchain. Ils peuvent √©galement √™tre programm√©s pour distribuer les fonds en fonction de crit√®res pr√©cis, contribuant √† la **mesurabilit√©** de l\'**impact**.',
        },
        {
            role: 'user',
            content: 'Comment le Curriculum Vitae Num√©rique Universel (CVNU) pourrait-il √™tre int√©gr√© ?',
        },
        {
            role: 'assistant',
            content: 'Le CVNU üíº pourrait servir de passeport num√©rique pour les organisations b√©n√©ficiaires, centralisant des informations v√©rifi√©es sur leur **impact** social, leur gouvernance et leur **transparence**. Int√©gr√© au syst√®me, il permettrait aux donateurs de faire des choix √©clair√©s et de suivre la **mesurabilit√©** des actions soutenues.',
        },
        {
            role: 'user',
            content: 'Quel serait le r√¥le de l\'√âconomie Circulaire dans ce contexte ?',
        },
        {
            role: 'assistant',
            content: 'L\'√âconomie Circulaire ‚ôªÔ∏è offre un cadre pour l\'**int√©gration** de la g√©n√©rosit√© Programmer en connectant les flux (emploi et r√©emploi, Ressources et Recette fiscale) √† des actions solidaires. Des m√©canismes automatis√©s via l\'AGI et des smart contracts pourraient diriger une partie de la valeur g√©n√©r√©e par l\'√©conomie circulaire vers des initiatives sociales ou environnementales, rendant la g√©n√©rosit√© plus **accessible** et intrins√®quement li√©e √† nos activit√©s √©conomiques.',
        },
        {
          role: 'user',
          content: `Imaginons une plateforme o√π les dons sont g√©n√©r√©s non seulement par des contributions directes, mais aussi par utilisation des surplus et recycl√©s; les ventes second-hand, la location d objets, etc. Cette approche cr√©erait une boucle vertueuse, o√π l emploi de ressources partag√©es financerait des initiatives sociales et environnementales de mani√®re durable. ‚ú®,Ta r√©ponse doit √™tre r√©dig√© au format HTML Int√©grant La pr√©sentation de la g√©n√©rosit√© programm√©es du concept d'√©conomies, circulaire et les 'curriculum vitae num√©rique universel', respectant les normes du Web s√©mantique W3C int√©grant des emoji int√©lligent associer`,
        }
        ],
        model: 'gemma2-9b-it',
    });

    res.status(200).send(chatCompletion.choices[0].message.content);
} catch (error) {
    res.status(500).send('Une erreur est survenue');
}
});

app.get('/conversation_instance', async (req, res) => {
  try {
      const chatCompletion = await groq.chat.completions.create({
          messages: [
              {
                  role: 'system',
                  content: 'Vous √™tes un assistant serviable qui explique des concepts complexes simplement.',
              },
              {
                  role: 'user',
                  content: 'Expliquez la G√©n√©rosit√© Programm√©e en une phrase.',
              },
              {
                  role: 'assistant',
                  content: 'La G√©n√©rosit√© Programm√©e est un syst√®me o√π la technologie facilite les dons directs et transparents √† partir de surplus budg√©taires individuels vers des causes sociales v√©rifi√©es.',
              },
              {
                  role: 'user',
                  content: 'Quels sont les principaux avantages de ce syst√®me ?  Ta r√©ponse doit √™tre r√©dig√©e au format liste en HTML, respectant les normes du Web s√©mantique W3C int√©grant des emoji intelligents associ√©s aux concepts cl√©s.',
              },
          ],
          model: 'gemma2-9b-it',
      });

      res.status(200).send(chatCompletion.choices[0].message.content);
  } catch (error) {
      res.status(500).send('Une erreur est survenue');
  }
});
app.get('/AGI_et_Generosite_Programmee', async (req, res) => {
  try {
      const chatCompletion = await groq.chat.completions.create({
          messages: [
            {role:'system',content:`
              La G√©n√©rosit√© Programm√©e : Quand la Technologie Sert la Solidarit√©

${Generous.introduction}

**Les Trois Piliers de la G√©n√©rosit√© Programm√©e :**
- **${generositeProgrammeePiliers.transparenceEtConfiance.nom}**: ${generositeProgrammeePiliers.transparenceEtConfiance.description} (Technologies associ√©es: ${generositeProgrammeePiliers.transparenceEtConfiance.technologiesAssociees.join(', ')})
- **${generositeProgrammeePiliers.impactEtMesurabilite.nom}**: ${generositeProgrammeePiliers.impactEtMesurabilite.description} (Outils associ√©s: ${generositeProgrammeePiliers.impactEtMesurabilite.outilsAssocies.join(', ')})
- **${generositeProgrammeePiliers.integrationEtAccessibilite.nom}**: ${generositeProgrammeePiliers.integrationEtAccessibilite.description} (Domaines d'application: ${generositeProgrammeePiliers.integrationEtAccessibilite.domainesApplication.join(', ')})

En tenant compte de ces piliers, r√©fl√©chissez √† la relation entre l'**Intelligence Artificielle G√©n√©rative (AGI)** et le concept de la **G√©n√©rosit√© Programm√©e**.
            `},
              {
                  role: 'user',
                  content: `** R√©dige un article de blog sur l'AGI, le concept de G√©n√©rosit√© Programm√©e et ses applications. Ta r√©ponse doit √™tre r√©dig√©e au format liste en HTML, respectant les normes du Web s√©mantique W3C int√©grant des emoji intelligents associ√©s aux concepts cl√©s.`,
              },
          ],
          model: 'gemma2-9b-it',
      });

      res.status(200).send(chatCompletion.choices[0].message.content);
  } catch (error) {
      res.status(500).send('Une erreur est survenue');
  }
});
app.get('/AGI_et_Generosite_Programmee_plan', async (req, res) => {
  try {
      const chatCompletion = await groq.chat.completions.create({
          messages: [
              {role:'system',content:`
                La G√©n√©rosit√© Programm√©e : Quand la Technologie Sert la Solidarit√©

Imagine un avenir o√π la solidarit√© ne se limite pas √† un √©lan spontan√©, mais devient une opportunit√© int√©gr√©e, fluide et transparente dans notre vie quotidienne. Un futur o√π les exc√©dents budg√©taires individuels peuvent se transformer en un soutien concret pour ceux qui en ont le plus besoin, en quelques clics et avec une visibilit√© totale. Ce futur, c'est la promesse de la G√©n√©rosit√© Programm√©e.

Le Contexte : Un Potentiel Inexploit√©

Aujourd'hui, les m√©canismes de redistribution existants peuvent parfois sembler complexes, distants ou manquer de clart√© quant √† leur impact direct. Parall√®lement, nous constatons que les surplus budg√©taires individuels repr√©sentent un potentiel consid√©rable pour amplifier la solidarit√© au sein de notre soci√©t√©.

L'Id√©e Centrale : L'√âtat comme Facilitateur de la Solidarit√©

La G√©n√©rosit√© Programm√©e repose sur une id√©e simple mais puissante : l'√âtat joue un r√¥le proactif en cr√©ant un canal direct et transparent entre les citoyens et des causes sociales v√©rifi√©es. En s'appuyant sur les outils num√©riques et les donn√©es fiscales existantes, l'√âtat peut devenir un facilitateur cl√© de la solidarit√©.

Le Fonctionnement en Quatre √âtapes Cl√©s (via le syst√®me "G√âN√âROS") :

Notification Personnalis√©e : Un citoyen re√ßoit une notification claire et s√©curis√©e l'informant d'un surplus budg√©taire potentiel, pr√©sent√© comme une opportunit√© d'agir concr√®tement. Exemple : Claire re√ßoit un message concernant un trop-per√ßu fiscal.
Choix √âclair√© via une Interface Intuitive (G√âN√âROS) : Le syst√®me intelligent G√âN√âROS propose des options de redistribution claires et contextualis√©es. Les citoyens re√ßoivent des informations pertinentes sur les causes, leur urgence et l'impact potentiel de leur don.
Action Simple et Ma√Ætris√©e : Le citoyen choisit le montant qu'il souhaite redistribuer et la cause qu'il d√©sire soutenir, conservant un contr√¥le total sur sa d√©cision. L'interface est con√ßue pour √™tre simple et inspirer confiance.
Feedback Transparent et Valorisation : Apr√®s son action, le citoyen re√ßoit un retour d'information pr√©cis sur l'impact concret de son don, potentiellement enrichi de t√©moignages et de donn√©es quantifiables. Une reconnaissance fiscale pourrait venir valoriser cet acte de solidarit√©.
L'Apport Potentiel de la Technologie Blockchain (Smart Contracts) :

L'int√©gration de la technologie blockchain et des Smart Contracts (comme une version adapt√©e de cvnu.sol) pourrait automatiser et enregistrer de mani√®re immuable chaque √©tape du processus. Cela offrirait une transparence totale, une tra√ßabilit√© compl√®te et une v√©rification par tous les acteurs.

Les B√©n√©fices Cl√©s Attendus :

Efficacit√© Accrue : Les fonds sont canalis√©s rapidement vers les besoins les plus urgents.
Transparence Totale : Les informations sur les causes, l'impact et potentiellement la tra√ßabilit√© via la blockchain sont claires.
Responsabilisation Citoyenne : Offre une mani√®re simple et directe de contribuer au bien commun.
Sans Surco√ªt pour l'√âtat (potentiel) : Utilisation de fonds d√©j√† disponibles (surplus budg√©taires).
Valorisation de la Solidarit√© : Reconnaissance de l'engagement citoyen.
Points de Discussion √âthiques et Pratiques :

Le concept soul√®ve des questions importantes qui n√©cessitent une discussion approfondie :

Volontariat vs. Incitation Morale
Utilisation des Donn√©es Fiscales et limites √©thiques
Neutralit√© et Fiabilit√© de l'IA (G√âN√âROS)
R√¥le de l'√âtat (compl√©ment ou alternative aux dispositifs existants)
Confiance et Adh√©sion des citoyens
En Conclusion : Une Vision Audacieuse pour la Solidarit√© du 21√®me Si√®cle

La G√©n√©rosit√© Programm√©e repr√©sente une vision novatrice de la solidarit√©, exploitant la puissance de la technologie pour rendre l'acte de donner plus simple, plus transparent et plus impactant. En ouvrant la discussion sur ses implications √©thiques et pratiques, nous pouvons collectivement fa√ßonner un avenir o√π la technologie sert v√©ritablement l'humain et renforce les liens de notre soci√©t√©.


                `},
              {
                  role: 'user',
                  content: `** R√©dige un Un plan d'action pour le d√©veloppement et AGI le concepte de ${Generous} Tresors et ses domaine applications. Ta r√©ponse doit √™tre r√©dig√© au format liste en HTML Int√©grant les diff√©rentes phases de d√©veloppement du plan d'action, respectant les normes du Web s√©mantique W3C int√©grant des emoji int√©lligent associer`,
              },
          ],
          model: 'gemma2-9b-it',
      });

      res.status(200).send(chatCompletion.choices[0].message.content);
  } catch (error) {
      res.status(500).send('Une erreur est survenue');
  }
});
// ... code pr√©c√©dent ...
app.listen(port, () => console.log(`Server running on port http://localhost:${port}`));